set encoding=utf-8    " to support german Umlaute
scriptencoding utf-8
set tw=0 " max line length = 0, so now auto newline chars

" =====================================================================

set number                  " turn on line numbers
set norelativenumber        " nice, but not for beginners and streaming
set tabstop=2
set softtabstop=2
set shiftwidth=2
syntax enable               " enable syntax highlighting
set bg=dark                 " set the background to dark 
set nohlsearch              " disable the weird search highlights

" =====================================================================
" Python specific settings upon loading *.py files ====================
" from:   https://realpython.com/vim-and-python-a-match-made-in-heaven/

au BufNewFile,BufRead *.py
    \ set tabstop=4 |
    \ set softtabstop=4 |
    \ set shiftwidth=4 |
    \ set expandtab |
    \ set autoindent |
    \ set fileformat=unix

" =====================================================================
" More useful stuff from the same article
" Enable folding
set foldmethod=indent
set foldlevel=99

" Enable folding with the spacebar
nnoremap <space> za


" =====================================================================
" prevents truncated yanks, deletes, etc (important!)
" increases the maximum buffer size so temp data will not be lost
set viminfo='20,<1000,s1000    
" =====================================================================
if $PLATFORM == 'mac'
    " required for mac.delete to work"
    set backspace=indent,eol,start
endif
" =====================================================================
" Next setting is to prevent automatic newline characters in txt files on windows
autocmd BufRead,BufNewFile   *.txt setlocal formatoptions-=t formatoptions+=croql
" =====================================================================
" configure backup to one central folder
" Check if the .vimtmp folder exists in $HOME. If not it will be created
if !isdirectory($HOME."/.vimtmp")
    call mkdir($HOME."/.vimtmp", "", 0770)
endif

set backupdir=$HOME/.vimtmp//,. " for backup files
set directory=$HOME/.vimtmp//,. " for swap files
set undodir=$HOME/.vimtmp//,. " for undo files
" The double slash at the end ensures that there is no conflict in case of two files
" having the same name (maybe only honored for swap files)
" The ,. allow vim to use the current directory if the former doesn't exist.

set undofile " enable undo files
set backup " enable backup (and swap) 

" ======================================================================
" ======================================================================
" Install vim-plug if not already installed ============================
" Apparently plug is better and Vim 8 Plugins suck =====================
if empty(glob('~/.vim/autoload/plug.vim'))
  silent !curl -fLo ~/.vim/autoload/plug.vim --create-dirs
      \ https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
  autocmd VimEnter * PlugInstall
  echo "Don't forget to GoInstallBinaries if you're doing Go dev."
endif

" only load plugins if Plug detected
if filereadable(expand("~/.vim/autoload/plug.vim"))
  call plug#begin('~/.vimplugins')
  Plug 'vim-pandoc/vim-pandoc'
  Plug 'vim-pandoc/vim-pandoc-syntax'
  Plug 'vim-scripts/indentpython.vim'  " includes skipped line indents
  Plug 'vim-syntastic/syntastic'  " Check Python3 Syntax on save
  Plug 'nvie/vim-flake8'  " Add PEP 8 checking for Python3
  Plug 'davidhalter/jedi-vim' " the jedi completion engine for Python
  Plug 'lifepillar/vim-mucomplete' " Minimalist autocomplete popup 
  Plug 'lifepillar/vim-gruvbox8' " An optimized gruvbox colorscheme
  call plug#end()
endif

colorscheme gruvbox8 " set the colorscheme (now installed)

" enable omni-completion
filetype plugin on
set omnifunc=syntaxcomplete#Complete

" Make the Python code look pretty
let python_highlight_all=1
syntax on

" Settings for vim-jedi (Python)
let g:jedi#goto_command = "<leader>d"
let g:jedi#goto_assignments_command = "<leader>g"
let g:jedi#goto_stubs_command = "<leader>s"
let g:jedi#goto_definitions_command = ""
let g:jedi#documentation_command = "K"
let g:jedi#usages_command = "<leader>n"
let g:jedi#completions_command = "<C-Space>"
let g:jedi#rename_command = "<leader>r"

" Settings for the mucomplete plugin
set completeopt+=menuone
set completeopt+=noselect
set shortmess+=c  " Shut off completion messages
set belloff+=ctrlg " If Vim beebs during completion

let g:mucomplete#enable_auto_at_startup = 0

" ======================================================================
" ======================================================================
" From the defaul vimrc example file
" When started as "evim", evim.vim will already have done these settings,
" bail out.
if v:progname =~? "evim"
  finish
endif

" Get the defaults that most users want.
source $VIMRUNTIME/defaults.vim

if has("vms")
  set nobackup		" do not keep a backup file, use versions instead
else
  set backup		" keep a backup file (restore to previous version)
  if has('persistent_undo')
    set undofile	" keep an undo file (undo changes after closing)
  endif
endif

" if &t_Co > 2 || has("gui_running")
    " Switch on highlighting the last used search pattern.
"   set hlsearch
" endif

" Put these in an autocmd group, so that we can delete them easily.
" augroup vimrcEx
"  au!

  " For all text files set 'textwidth' to 78 characters.
  " autocmd FileType text setlocal textwidth=78
" augroup END

" The matchit plugin makes the % command work better, but it is not backwards
" compatible. The ! means the package won't be loaded right away but when plugins are
" loaded during initialization.
if has('syntax') && has('eval')
  packadd! matchit
endif

" ======================================================================
" ======================================================================
" More from rwxrobb ====================================================

set expandtab " replace tabs with spaces automatically
set scrolloff=2 " prevent the cursor from moving off screen

" keep the terminal title updated
set laststatus=0
set icon
